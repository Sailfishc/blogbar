{% extends "layout.html" %}
{% from 'macro/ui.html' import pagination %}

{% block page_title %}博客广场{% endblock %}
{% block page_content %}
   <div class="container">
      <div class="row">
         <div class="col-sm-8">
            <h2 class="no-margin-top">
               <span class="fa fa-cube"></span> 博客广场
               <small>排名不分先后</small>
            </h2>

            {% set admin = permissions.AdminPermission().check() %}

            <div class="row">
               <div class="kinds-selector col-xs-12 col-md-10">
                  <a class="kind {% if not kind_id or kind_id == 0 %}on{% endif %}"
                     href="{{ url_for('blog.square') }}">全部</a>

                  {% for kind in kinds %}
                     <a class="kind {% if kind_id == kind.id %}on{% endif %}"
                        href="{{ url_for('blog.square', kind_id=kind.id) }}">
                        {{ kind.name }}
                     </a>
                  {% endfor %}
               </div>
            </div>

            <div class="blogs clearfix">
               {% if not blogs.total %}
                  <p class="text-light">暂未收录</p>
               {% endif %}

               {% for blog in blogs.items %}
                  {% set has_kinds = blog.blog_kinds.count() %}

                  <div class="blog col-sm-6 {% if admin and not has_kinds %}no-kinds{% endif %}">
                     {% if admin %}
                        <a href="{{ url_for('admin.edit_blog', uid=blog.id) }}"
                           class=" pull-right">edit</a>
                     {% endif %}

                     <div class="title">
                        <a href="{{ url_for('blog.view', uid=blog.id) }}">
                           {{ blog.title }}</a>

                        {% if blog.offline %}
                           <span class="offline">offline</span>
                        {% endif %}
                     </div>

                     {% if blog.subtitle %}
                        <div class="subtitle">{{ blog.subtitle }}</div>
                     {% endif %}

                     <div class="kinds">
                        {% for blog_kind in blog.blog_kinds %}
                           {% set kind = blog_kind.kind %}
                           <span>{{ kind.name }}</span>
                           {% if not loop.last %} · {% endif %}
                        {% endfor %}
                     </div>
                     {#                  <div class="author">by <span>{{ blog.author }}</span></div>#}
                  </div>

                  {% if loop.index % 2 == 0 %}
                     <div class="clearfix"></div>
                  {% endif %}
               {% endfor %}
            </div>

            {{ pagination(blogs) }}
         </div>

         <div class="col-sm-4">
            <h2 class="no-margin-top">
               <span class="fa fa-clock-o"></span> 最新收录
            </h2>

            <div class="latest-blogs">
               {% for blog in latest_blogs %}
                  <div class="latest-blog">
                     <a class="title"
                        href="{{ url_for('blog.view', uid=blog.id) }}">{{ blog.title }}</a>
                     {% if blog.subtitle %}
                        <div class="subtitle">{{ blog.subtitle }}</div>
                     {% endif %}
                  </div>
               {% endfor %}
            </div>
         </div>
      </div>
   </div>
{% endblock %}
